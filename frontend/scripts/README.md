# Record.json 生成脚本

## 说明

这个脚本用于扫描 `public/novels` 目录下的所有txt文件，并生成包含字数信息的 `record.json` 文件。

## 使用方法

```bash
# 方法1：使用 pnpm 命令（推荐）
pnpm generate-record

# 方法2：直接运行脚本
node scripts/generate-record.js
```

## 功能特性

- ✅ **自动扫描多层目录结构**
- ✅ 读取txt文件内容计算准确字数
- ✅ 格式化文件大小显示
- ✅ 按标题自动排序
- ✅ 生成详细的统计信息
- ✅ 错误处理和容错机制
- ✅ 目录结构统计

## 输出格式

生成的 `record.json` 文件采用以下简洁格式：

```json
[
  [
    "文件路径",
    "文件大小",
    "字数"
  ]
]
```

### 示例

```json
[
  [
    "起点中文网/天蚕土豆/斗破苍穹.txt",
    "2.5MB",
    "1250000字"
  ],
  [
    "作者名/小说.txt",
    "1.8MB",
    "900000字"
  ]
]
```

### 格式说明

- **文件路径**: 相对于 `novels/` 目录的相对路径
- **文件大小**: 自动格式化（B/KB/MB/GB）
- **字数**: 文件内容的准确字符数
- **标题提取**: 自动从文件名提取（无需重复存储）

## 字段说明

1. **文件路径**：相对于 `novels/` 目录的完整路径
2. **文件大小**：格式化显示（B/KB/MB/GB）
3. **字数**：文件内容的字符数（包含所有字符）

## 功能特性

- ✅ **动态路径扫描**：支持任意层级目录结构
- ✅ **智能过滤**：自动排除 `robots.txt` 文件
- ✅ **路径标准化**：自动转换路径分隔符（Windows/Linux）
- ✅ **UTF-8编码支持**：假设文件使用UTF-8编码
- ✅ **错误处理**：读取失败时标记为"未知字数"

## 注意事项

1. 只处理 `.txt` 扩展名的文件
2. 大文件处理可能需要一些时间
3. 文件名中的扩展名会被自动移除作为标题
4. 支持无限深度的目录嵌套

## 统计信息

脚本运行完成后会显示：

- 总字数统计
- 成功处理的文件数量
- 读取失败的文件数量

## 示例输出

```
开始扫描小说文件...
正在处理: 伏濑/关于我转生变成史莱姆这档事01.txt
  ✓ 标题: 关于我转生变成史莱姆这档事01
  ✓ 文件大小: 420.42KB
  ✓ 字数: 150,542字

✅ 生成完成！
📚 共处理 26 本小说
📁 输出文件: /path/to/record.json

📊 统计信息:
  • 总字数: 43,646,343字
  • 已知字数: 26本
  • 未知字数: 0本
```

## 更新建议

当您添加新的小说文件时，建议重新运行此脚本来更新 `record.json`：

```bash
pnpm generate-record
```

这样可以确保：
- 所有新添加的小说都有准确的字数统计
- 移除的小说不会出现在列表中
- 文件信息保持最新状态

## 支持的目录结构

脚本支持**任意多层目录结构**，自动识别并适配：

### 基础结构
```
public/novels/
├── 作者1/
│   ├── 小说1.txt
│   └── 小说2.txt
├── 作者2/
│   ├── 小说3.txt
│   └── 小说4.txt
└── record.json
```

### 平台结构（推荐）
```
public/novels/
├── 起点中文网/
│   ├── 作者1/
│   │   ├── 小说1.txt
│   │   └── 小说2.txt
│   └── 作者2/
│       └── 小说3.txt
├── 刺猬猫/
│   ├── 作者3/
│   │   └── 小说4.txt
│   └── 作者4/
│       └── 小说5.txt
└── record.json
```

### 自定义结构
```
public/novels/
├── 网站A/
│   └── 分类1/
│       └── 作者1/
│           └── 小说1.txt
├── 网站B/
│   └── 作者2/
│       └── 小说2.txt
└── 小说3.txt  # 直接放在根目录
```

### 前端自动识别规则
- **1层路径**：`小说.txt` → 作者显示为"未知作者"
- **2层路径**：`作者名/小说.txt` → 显示作者名
- **3层及以上**：`平台/作者名/小说.txt` → 显示"平台 / 作者名"
- **任意深度**：支持无限嵌套，最后两层作为"作者"信息

## 路径显示效果

- `作者名/小说.txt` → 作者：作者名
- `起点中文网/天蚕土豆/斗破苍穹.txt` → 作者：起点中文网 / 天蚕土豆
- `轻之文库/镰池和马/魔法禁书目录.txt` → 作者：轻之文库 / 镰池和马